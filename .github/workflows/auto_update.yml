name: Update Posts and Deploy to GitHub Pages

on:
  # 1. ç•¶æœ‰ç¨‹å¼ç¢¼æ¨é€åˆ° main åˆ†æ”¯æ™‚è§¸ç™¼ï¼ˆä½ æ‰‹å‹•æ›´æ–°å…§å®¹çš„æƒ…æ³ï¼‰
  push:
    branches:
      - main

  # 2. æ¯å¤©æ—©ä¸Š 6:50ï¼ˆå°ç£æ™‚é–“ï¼‰è‡ªå‹•æ›´æ–°ï¼ˆUTC = -8ï¼‰
  schedule:
    - cron: '50 22 * * *'  # æ¯å¤© UTC æ™‚é–“ 22:50 = å°ç£ 6:50 AM

jobs:
  update_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Set up Git config
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # ğŸ”„ æ”¹ç‚ºé rebase çš„æ–¹å¼é€²è¡Œ pullï¼Œé¿å…éŒ¯èª¤ 128
      - name: Pull latest changes (no rebase)
        run: git pull origin main

      # ğŸ§  åœ¨æ­¤å€å¡ŠåŠ å…¥ä½ çš„å…§å®¹æ›´æ–°è…³æœ¬ï¼Œå¦‚æ›´æ–° JSONã€ç¶²ç«™å…§å®¹ç­‰
      - name: Run update script
        run: |
          echo "Put your content update commands here"
          # ä¾‹å¦‚ï¼špython generate_sitemap.py æˆ– node build.js

      # âœ… è‡ªå‹• commit è‹¥æœ‰è®Šæ›´
      - name: Commit changes
        run: |
          git add .
          git commit -m "Auto-update content" || echo "No changes to commit"

      # ğŸš€ æ¨é€å› GitHub
      - name: Push changes to GitHub
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main

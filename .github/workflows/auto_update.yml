name: Update Posts and Deploy to GitHub Pages

on:
  # 1. 當有程式碼推送到 main 分支時觸發（你手動更新內容的情況）
  push:
    branches:
      - main

  # 2. 每天早上 6:50（台灣時間）自動更新（UTC = -8）
  schedule:
    - cron: '50 22 * * *'  # 每天 UTC 時間 22:50 = 台灣 6:50 AM

jobs:
  update_and_deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v3
        with:
          persist-credentials: false

      - name: Set up Git config
        run: |
          git config --global user.name 'github-actions[bot]'
          git config --global user.email 'github-actions[bot]@users.noreply.github.com'

      # 🔄 改為非 rebase 的方式進行 pull，避免錯誤 128
      - name: Pull latest changes (no rebase)
        run: git pull origin main

      # 🧠 在此區塊加入你的內容更新腳本，如更新 JSON、網站內容等
      - name: Run update script
        run: |
          echo "Put your content update commands here"
          # 例如：python generate_sitemap.py 或 node build.js

      # ✅ 自動 commit 若有變更
      - name: Commit changes
        run: |
          git add .
          git commit -m "Auto-update content" || echo "No changes to commit"

      # 🚀 推送回 GitHub
      - name: Push changes to GitHub
        uses: ad-m/github-push-action@v0.6.0
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: main
